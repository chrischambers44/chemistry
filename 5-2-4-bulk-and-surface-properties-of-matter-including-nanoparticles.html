<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AQA 5.2.4 Tutorial – Bulk & Surface Properties (Nanoparticles)</title>
  <style>
    :root{
      --bg:#0b1020; --card:rgba(255,255,255,.08); --card2:rgba(255,255,255,.06);
      --text:#eef2ff; --muted:rgba(238,242,255,.75); --border:rgba(255,255,255,.14);
      --accent:#7c5cff; --good:#2ecc71; --bad:#ff5c7a; --warn:#ffd166;
    }
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:radial-gradient(1200px 650px at 10% 0%, rgba(124,92,255,.25), transparent 50%),
                 radial-gradient(900px 550px at 90% 10%, rgba(46,204,113,.18), transparent 55%),
                 linear-gradient(180deg, var(--bg), #050817);
      color:var(--text);
    }
    header{max-width:1100px; margin:0 auto; padding:28px 18px 10px;}
    h1{margin:0 0 8px; font-size:1.65rem;}
    .sub{color:var(--muted); line-height:1.35; max-width:980px;}
    .wrap{max-width:1100px; margin:0 auto; padding:12px 18px 48px; display:grid; gap:14px;}
    .toolbar{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      padding:12px; border:1px solid var(--border); border-radius:14px; background:var(--card);
    }
    .pill{padding:8px 10px; border-radius:999px; border:1px solid var(--border);
      background:rgba(0,0,0,.18); color:var(--muted); font-size:.92rem; white-space:nowrap;}
    button{
      border:1px solid var(--border); background:rgba(255,255,255,.08); color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:650;
    }
    button:hover{border-color:rgba(255,255,255,.28);}
    button.primary{
      background:linear-gradient(135deg, rgba(124,92,255,.95), rgba(124,92,255,.55));
      border-color:rgba(124,92,255,.65);
    }
    button.danger{
      background:linear-gradient(135deg, rgba(255,92,122,.95), rgba(255,92,122,.45));
      border-color:rgba(255,92,122,.6);
    }
    .card{padding:16px; border-radius:16px; border:1px solid var(--border); background:var(--card);}
    .grid{display:grid; grid-template-columns:repeat(auto-fit, minmax(270px, 1fr)); gap:12px;}
    h2{margin:0 0 10px; font-size:1.25rem;}
    h3{margin:0 0 8px; font-size:1.05rem;}
    .muted{color:var(--muted);}
    .callout{
      border-left:3px solid rgba(124,92,255,.7); padding:10px 12px; background:rgba(255,255,255,.05);
      border-radius:12px; margin-top:10px; color:var(--muted); line-height:1.45;
    }
    .kbox{
      border:1px solid var(--border); border-radius:14px; padding:12px; background:var(--card2);
    }
    ul{margin:8px 0 0 18px; color:var(--muted);}
    .diagram{
      border:1px dashed rgba(255,255,255,.24); border-radius:14px; padding:12px; background:rgba(0,0,0,.16);
      color:var(--muted); line-height:1.35;
    }
    .q{
      padding:12px; border:1px solid var(--border); border-radius:14px; background:rgba(255,255,255,.06);
      margin-top:10px;
    }
    .opts{display:grid; gap:8px; margin-top:10px;}
    label.opt{
      display:grid; grid-template-columns:22px 1fr; gap:10px; align-items:start;
      padding:10px 12px; border-radius:14px; border:1px solid var(--border);
      background:rgba(0,0,0,.14); cursor:pointer;
    }
    label.opt:hover{border-color:rgba(255,255,255,.28);}
    input[type="radio"]{margin-top:3px;}
    .resultLine{margin-top:10px; font-weight:700;}
    .good{color:#b7f7cd;}
    .bad{color:#ffc1cb;}
    details{border:1px solid var(--border); border-radius:14px; background:rgba(255,255,255,.05); padding:10px 12px;}
    summary{cursor:pointer; font-weight:750;}
    .flash{
      display:grid; gap:10px; align-items:center;
      border:1px solid var(--border); border-radius:16px; padding:14px;
      background:rgba(0,0,0,.16);
    }
    .flashFace{font-size:1.05rem; line-height:1.35;}
    .flashBtns{display:flex; gap:10px; flex-wrap:wrap;}
    .tiny{font-size:.92rem;}
    textarea{
      width:100%; min-height:90px; border-radius:12px; border:1px solid var(--border);
      padding:10px; background:rgba(0,0,0,.18); color:var(--text);
      resize:vertical;
    }
    .scoreBox{
      border:1px solid var(--border); border-radius:16px; padding:14px;
      background:rgba(255,255,255,.06);
    }
    .tag{
      display:inline-block; padding:4px 10px; border-radius:999px; border:1px solid var(--border);
      font-weight:800; font-size:.85rem; margin-left:8px;
    }
    .tag.good{background:rgba(46,204,113,.18); border-color:rgba(46,204,113,.35);}
    .tag.bad{background:rgba(255,92,122,.16); border-color:rgba(255,92,122,.35);}
  </style>
</head>
<body>
<header>
  <h1>AQA 5.2.4 Tutorial – Bulk and surface properties (including nanoparticles)</h1>
  <div class="sub">
    This lesson covers AQA <b>5.2.4</b>: how <b>surface area</b> and <b>particle size</b> affect properties, with a focus on <b>nanoparticles</b>:
    what they are, why they behave differently, common uses, and possible risks.
  </div>
</header>

<div class="wrap">
  <div class="toolbar">
    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
      <span class="pill" id="pillSection">Section: 5.2.4</span>
      <span class="pill" id="pillProgress">Progress: 0%</span>
      <span class="pill" id="pillChecks">Checks: 0/4 done</span>
    </div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
      <button id="btnJumpNotes">Jump to Notes</button>
      <button id="btnJumpFlash">Jump to Flashcards</button>
      <button class="primary" id="btnJumpQuiz">Jump to Final Quiz</button>
      <button class="danger" id="btnReset">Reset progress</button>
    </div>
  </div>

  <!-- NOTES -->
  <div class="card" id="notes">
    <h2>Core idea for 5.2.4</h2>
    <div class="callout">
      <b>As particle size decreases, surface area to volume ratio increases.</b><br>
      This often makes substances <b>more reactive</b> and can change properties such as <b>melting point</b> and <b>how they interact with light</b>.
      Nanoparticles can have <b>different properties</b> to the same substance in bulk form.
    </div>

    <div class="grid" style="margin-top:12px;">
      <div class="kbox">
        <h3>Bulk vs small particles</h3>
        <ul>
          <li><b>Bulk material</b> = “normal sized” particles you can often see.</li>
          <li><b>Powders</b> have more surface area than large chunks.</li>
          <li>More surface area usually means <b>faster reaction rate</b> (more collisions happen at the surface).</li>
        </ul>
        <div class="diagram tiny" style="margin-top:10px;">
          Example: A powder reacts faster than a lump because there is more surface exposed.
        </div>

        <div class="q" data-check="surfaceArea">
          <b>Quick check (Surface area)</b><br>
          Why does a powder usually react faster than a large lump of the same substance?
          <div class="opts" id="opts_surfaceArea"></div>
          <button class="primary" onclick="markCheck('surfaceArea')">Mark</button>
          <div class="resultLine" id="res_surfaceArea"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_surfaceArea"></div>
          </details>
        </div>
      </div>

      <div class="kbox">
        <h3>Nanoparticles: what are they?</h3>
        <ul>
          <li><b>Nanoparticles</b> are extremely small particles: roughly <b>1–100 nanometres</b> (nm) in size.</li>
          <li>1 nm is <b>1×10⁻⁹ m</b> (a billionth of a metre).</li>
          <li>They have a very high <b>surface area to volume ratio</b>.</li>
        </ul>
        <div class="diagram tiny" style="margin-top:10px;">
          If you break something into tiny particles, the total surface area increases massively.
        </div>

        <div class="q" data-check="nanoDef">
          <b>Quick check (Definition)</b><br>
          Which size range is usually used for nanoparticles?
          <div class="opts" id="opts_nanoDef"></div>
          <button class="primary" onclick="markCheck('nanoDef')">Mark</button>
          <div class="resultLine" id="res_nanoDef"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_nanoDef"></div>
          </details>
        </div>
      </div>

      <div class="kbox">
        <h3>Why do nanoparticles behave differently?</h3>
        <ul>
          <li><b>More atoms on the surface</b> (compared to inside) → more interactions with surroundings.</li>
          <li>This can increase <b>reactivity</b> and change how they behave in reactions.</li>
          <li>They can also have different <b>optical properties</b> (how they interact with light).</li>
        </ul>
        <div class="callout tiny">
          Exam-friendly phrase: <b>“Large surface area to volume ratio”</b> is the key reason.
        </div>

        <div class="q" data-check="whyDifferent">
          <b>Quick check (Reason)</b><br>
          The main reason nanoparticles can be more reactive than bulk material is…
          <div class="opts" id="opts_whyDifferent"></div>
          <button class="primary" onclick="markCheck('whyDifferent')">Mark</button>
          <div class="resultLine" id="res_whyDifferent"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_whyDifferent"></div>
          </details>
        </div>
      </div>

      <div class="kbox">
        <h3>Uses and possible risks</h3>
        <ul>
          <li><b>Uses</b>: catalysts, electronics, cosmetics (e.g. suncream), antibacterial coatings, medical applications.</li>
          <li><b>Risks</b>: can enter the body more easily (inhaled/absorbed); effects may be unknown.</li>
          <li>Important idea: <b>not all nanoparticle risks are fully understood</b> — evidence is still developing.</li>
        </ul>
        <div class="diagram tiny" style="margin-top:10px;">
          Example: TiO₂ or ZnO nanoparticles in suncream can block UV without being visibly white on the skin.
        </div>

        <div class="q" data-check="risk">
          <b>Quick check (Risks)</b><br>
          Why might nanoparticles sometimes have higher health risks than larger particles of the same substance?
          <div class="opts" id="opts_risk"></div>
          <button class="primary" onclick="markCheck('risk')">Mark</button>
          <div class="resultLine" id="res_risk"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_risk"></div>
          </details>
        </div>
      </div>
    </div>

    <details style="margin-top:12px;">
      <summary>Key vocabulary (useful for mark schemes)</summary>
      <div class="muted tiny" style="margin-top:10px; line-height:1.5;">
        <b>Surface area</b> – area of the outside of a solid (where reactions happen).<br>
        <b>Surface area to volume ratio</b> – compares surface area with volume; increases as particles get smaller.<br>
        <b>Nanoparticle</b> – particle 1–100 nm; may have different properties to bulk material.<br>
        <b>Bulk</b> – normal sized material, not nanoscale.<br>
        <b>Reactivity</b> – how readily a substance reacts; often increases with surface area.
      </div>
    </details>
  </div>

  <!-- FLASHCARDS -->
  <div class="card" id="flashcards">
    <h2>Flashcards (retrieval practice)</h2>
    <div class="muted">
      Use these to practise quick recall. Click <b>Flip</b> then rate yourself. Aim for “Good” twice in a row.
    </div>
    <div class="flash" style="margin-top:12px;">
      <div class="flashFace" id="flashFace"></div>
      <div class="muted tiny" id="flashHint"></div>
      <div class="flashBtns">
        <button id="btnFlip" class="primary">Flip</button>
        <button id="btnAgain">Again</button>
        <button id="btnGood">Good</button>
        <button id="btnNext">Next</button>
      </div>
    </div>
    <div class="callout tiny">
      Tip: If a card is “Again”, say the answer out loud, then read it, then repeat once more.
    </div>
  </div>

  <!-- NOTES / EXPORT -->
  <div class="card">
    <h2>My notes (optional)</h2>
    <div class="muted">Write a few bullet points of what you find hardest. You can export them to copy/paste.</div>
    <textarea id="notesBox" placeholder="Example: I forget the nanoparticle size range, and why they are more reactive..."></textarea>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
      <button id="btnExport" class="primary">Export notes (copy)</button>
      <button id="btnClearNotes">Clear notes</button>
      <span class="pill" id="pillCopied" style="display:none;">Copied!</span>
    </div>
  </div>

  <!-- FINAL QUIZ -->
  <div class="card" id="finalQuiz">
    <h2>Final quiz (mixed)</h2>
    <div class="muted">Try this without looking back. Then check the review to see what to revise.</div>
    <div id="quizArea" style="margin-top:12px;"></div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center;">
      <button class="primary" id="btnMarkFinal">Mark final quiz</button>
      <button id="btnRetryFinal">Retry final quiz</button>
      <span class="pill" id="pillFinalScore" style="display:none;"></span>
    </div>
    <div id="finalReview" style="margin-top:12px;"></div>
  </div>
</div>

<script>
  // -------------------------
  // Data for quick checks (4)
  // -------------------------
  const checks = {
    surfaceArea: {
      options: [
        "Because the powder has a lower temperature",
        "Because the powder has more surface area, so more collisions happen each second",
        "Because powders are always catalysts",
        "Because the powder has weaker bonds"
      ],
      answer: 1,
      explanation: "Reactions with solids happen at the surface. A powder has much more surface area than a lump, so there are more collisions per second → faster rate."
    },
    nanoDef: {
      options: [
        "1–100 nm",
        "1–100 mm",
        "1–100 μm",
        "1–100 m"
      ],
      answer: 0,
      explanation: "Nanoparticles are typically defined as being about 1–100 nanometres (nm) in size."
    },
    whyDifferent: {
      options: [
        "They are always made of metals",
        "They have a much larger surface area to volume ratio",
        "They have no atoms inside them",
        "They are always liquids"
      ],
      answer: 1,
      explanation: "Nanoparticles have a large surface area to volume ratio, so a greater proportion of atoms are on the surface, making them more reactive and changing properties."
    },
    risk: {
      options: [
        "They are too heavy to move through the body",
        "They are always poisonous",
        "They can be inhaled/absorbed and can enter cells; their effects may be unknown",
        "They have no surface area"
      ],
      answer: 2,
      explanation: "Because they’re very small, nanoparticles can enter the body more easily (e.g. inhalation) and may pass into cells. Some risks are not fully understood yet."
    }
  };

  // -------------------------
  // Flashcards (retrieval)
  // -------------------------
  const flashcards = [
    {front:"What is meant by ‘bulk’ material?", back:"Normal sized material (not nanoscale). Its properties may differ from nanoparticles of the same substance.", hint:"Bulk vs nano."},
    {front:"What is the typical size range for nanoparticles?", back:"About 1–100 nanometres (nm).", hint:"Remember: nano = 10⁻⁹ m."},
    {front:"Why do powders react faster than large lumps?", back:"Powders have a larger surface area, so there are more collisions per second at the surface.", hint:"Surface collisions."},
    {front:"What happens to surface area to volume ratio as particle size decreases?", back:"It increases.", hint:"Smaller particles = proportionally more surface."},
    {front:"Why can nanoparticles be more reactive than bulk material?", back:"Large surface area to volume ratio means more atoms at the surface, so more interactions/collisions.", hint:"Atoms on the surface."},
    {front:"Give one use of nanoparticles in everyday life.", back:"Examples: suncream (TiO₂/ZnO), catalysts, electronics, antibacterial coatings, stain-resistant fabrics.", hint:"Pick one."},
    {front:"Why might nanoparticles pose health risks?", back:"They can be inhaled/absorbed, enter cells, and their long-term effects may be uncertain.", hint:"Small enough to get into the body."},
    {front:"What’s the key exam phrase that explains nanoparticle behaviour?", back:"Large surface area to volume ratio.", hint:"This unlocks marks."}
  ];

  // -------------------------
  // Final quiz (10 Qs)
  // -------------------------
  const finalQuiz = [
    {
      id:"F1",
      q:"Nanoparticles are typically defined as particles with sizes in the range…",
      options:["1–100 nm","1–100 mm","1–100 μm","1–100 km"],
      a:0,
      exp:"Nanoparticles are usually 1–100 nm. A nanometre is 1×10⁻⁹ m."
    },
    {
      id:"F2",
      q:"As particle size decreases, surface area to volume ratio generally…",
      options:["Decreases","Stays the same","Increases","Becomes zero"],
      a:2,
      exp:"Smaller particles have proportionally more surface compared with their volume, so the ratio increases."
    },
    {
      id:"F3",
      q:"A powder reacts faster than a lump mainly because…",
      options:["It has a higher temperature","It has more surface area for collisions","It is a catalyst","It is an alloy"],
      a:1,
      exp:"More surface area means more collisions per second where the reaction happens."
    },
    {
      id:"F4",
      q:"Why can nanoparticles show different properties compared with bulk material?",
      options:[
        "They contain different atoms",
        "They always have weaker bonds",
        "They have a very large surface area to volume ratio",
        "They are always ionic"
      ],
      a:2,
      exp:"A large proportion of atoms are on the surface, changing reactivity and other properties."
    },
    {
      id:"F5",
      q:"Which is a reasonable use of nanoparticles?",
      options:["Balancing equations","Suncream that blocks UV","Making atoms","Creating isotopes"],
      a:1,
      exp:"Nanoparticles such as TiO₂ or ZnO can block UV while remaining more transparent on the skin."
    },
    {
      id:"F6",
      q:"Which statement best links surface area to reaction rate?",
      options:[
        "Greater surface area → fewer collisions",
        "Greater surface area → more collisions per second → faster rate",
        "Greater surface area → lower temperature",
        "Greater surface area → no effect"
      ],
      a:1,
      exp:"Reactions with solids happen at the surface; more surface means more collisions each second."
    },
    {
      id:"F7",
      q:"A possible reason nanoparticles may carry higher health risks is that…",
      options:[
        "They cannot enter the body",
        "They are always toxic",
        "They can be inhaled/absorbed and enter cells; effects may be uncertain",
        "They have no surface area"
      ],
      a:2,
      exp:"Their tiny size can allow them into the body and even cells; long-term effects may not be fully understood."
    },
    {
      id:"F8",
      q:"Which is the best ‘nano’ statement?",
      options:[
        "Nanoparticles always melt at the same temperature as the bulk material",
        "Nanoparticles can have different properties to the bulk material",
        "Nanoparticles contain no atoms",
        "Nanoparticles are always gases"
      ],
      a:1,
      exp:"At nanoscale, properties can change because surface effects become much more important."
    },
    {
      id:"F9",
      q:"The most mark-winning phrase to explain nanoparticle behaviour is…",
      options:[
        "High density to mass ratio",
        "High surface area to volume ratio",
        "Low boiling point to melting point ratio",
        "High neutron to proton ratio"
      ],
      a:1,
      exp:"Surface area to volume ratio is the key phrase AQA expects."
    },
    {
      id:"F10",
      q:"Which option correctly defines ‘bulk’ material?",
      options:[
        "A substance made of ions",
        "Normal sized material, not nanoscale",
        "Only metals",
        "Only gases"
      ],
      a:1,
      exp:"Bulk material is the normal form (not nanoscale). Nanoparticles are tiny and may behave differently."
    }
  ];

  // -------------------------
  // State
  // -------------------------
  const state = {
    checksDone: {surfaceArea:false, nanoDef:false, whyDifferent:false, risk:false},
    finalAnswers: {},
    flashIndex: 0,
    flashFlipped: false
  };

  function $(id){ return document.getElementById(id); }
  function scrollToId(id){ document.getElementById(id).scrollIntoView({behavior:"smooth", block:"start"}); }

  function setPills(){
    const doneCount = Object.values(state.checksDone).filter(Boolean).length;
    const progress = Math.round(((doneCount) / 4) * 60 + (Object.keys(state.finalAnswers).length / finalQuiz.length) * 40);
    $("pillProgress").textContent = `Progress: ${progress}%`;
    $("pillChecks").textContent = `Checks: ${doneCount}/4 done`;
  }

  function renderCheck(key){
    const c = checks[key];
    const wrap = $("opts_"+key);
    wrap.innerHTML = "";
    c.options.forEach((opt, i) => {
      const lab = document.createElement("label");
      lab.className = "opt";
      const inp = document.createElement("input");
      inp.type = "radio";
      inp.name = "chk_"+key;
      inp.value = i;
      const div = document.createElement("div");
      div.textContent = opt;
      lab.appendChild(inp);
      lab.appendChild(div);
      wrap.appendChild(lab);
    });
    $("exp_"+key).textContent = c.explanation;
  }

  function markCheck(key){
    const c = checks[key];
    const chosen = document.querySelector(`input[name="chk_${key}"]:checked`);
    const res = $("res_"+key);
    if(!chosen){
      res.innerHTML = `<span style="color:var(--warn)"><b>Please choose an answer first.</b></span>`;
      return;
    }
    const val = Number(chosen.value);
    const ok = val === c.answer;
    state.checksDone[key] = true;

    res.innerHTML = ok
      ? `<span class="good">✔ Correct</span> <span class="muted tiny">— ${c.options[c.answer]}</span>`
      : `<span class="bad">✘ Incorrect</span> <span class="muted tiny">— Correct: ${c.options[c.answer]}</span>`;

    setPills();
  }

  // Flashcards
  function renderFlash(){
    const card = flashcards[state.flashIndex];
    state.flashFlipped = false;
    $("flashFace").textContent = card.front;
    $("flashHint").textContent = "Hint: " + card.hint;
    $("btnFlip").textContent = "Flip";
  }
  function flipFlash(){
    const card = flashcards[state.flashIndex];
    state.flashFlipped = !state.flashFlipped;
    $("flashFace").textContent = state.flashFlipped ? card.back : card.front;
    $("btnFlip").textContent = state.flashFlipped ? "Show question" : "Flip";
  }
  function nextFlash(){
    state.flashIndex = (state.flashIndex + 1) % flashcards.length;
    renderFlash();
  }

  // Notes export
  async function exportNotes(){
    const txt = $("notesBox").value.trim();
    if(!txt){
      alert("No notes yet. Write a couple of lines first.");
      return;
    }
    await navigator.clipboard.writeText(txt);
    $("pillCopied").style.display = "inline-block";
    setTimeout(()=> $("pillCopied").style.display = "none", 1200);
  }

  // Final quiz
  function renderFinalQuiz(){
    const qa = $("quizArea");
    qa.innerHTML = "";
    finalQuiz.forEach((q, idx) => {
      const card = document.createElement("div");
      card.className = "q";
      card.innerHTML = `<b>Q${idx+1}.</b> ${q.q}`;
      const opts = document.createElement("div");
      opts.className = "opts";

      q.options.forEach((opt, i) => {
        const lab = document.createElement("label");
        lab.className = "opt";
        const inp = document.createElement("input");
        inp.type = "radio";
        inp.name = "final_"+q.id;
        inp.value = i;
        if(state.finalAnswers[q.id] === i) inp.checked = true;
        inp.addEventListener("change", () => {
          state.finalAnswers[q.id] = i;
          setPills();
        });
        const div = document.createElement("div");
        div.textContent = opt;
        lab.appendChild(inp);
        lab.appendChild(div);
        opts.appendChild(lab);
      });

      card.appendChild(opts);
      qa.appendChild(card);
    });
    setPills();
  }

  function markFinal(){
    let correct = 0;
    const total = finalQuiz.length;
    const review = [];

    finalQuiz.forEach((q) => {
      const chosen = (q.id in state.finalAnswers) ? state.finalAnswers[q.id] : null;
      const ok = chosen === q.a;
      if(ok) correct++;
      review.push({q, chosen, ok});
    });

    const pct = Math.round((correct/total)*100);
    $("pillFinalScore").style.display = "inline-block";
    $("pillFinalScore").textContent = `Final quiz score: ${correct}/${total} (${pct}%)`;

    const fr = $("finalReview");
    fr.innerHTML = review.map((r, i) => {
      const tag = r.ok ? `<span class="tag good">Correct</span>` : `<span class="tag bad">Incorrect</span>`;
      const your = (r.chosen===null) ? "<i>(blank)</i>" : r.q.options[r.chosen];
      const cor = r.q.options[r.q.a];

      return `
        <div class="scoreBox" style="margin-top:10px;">
          <div><b>Q${i+1}.</b> ${r.q.q} ${tag}</div>
          <div class="muted" style="margin-top:6px;"><b>Your answer:</b> ${your}</div>
          <div class="muted"><b>Correct answer:</b> ${cor}</div>
          <div class="callout tiny"><b>Why:</b> ${r.q.exp}</div>
        </div>
      `;
    }).join("");

    scrollToId("finalReview");
  }

  function retryFinal(){
    state.finalAnswers = {};
    $("pillFinalScore").style.display = "none";
    $("finalReview").innerHTML = "";
    renderFinalQuiz();
    scrollToId("finalQuiz");
  }

  function resetAll(){
    state.checksDone = {surfaceArea:false, nanoDef:false, whyDifferent:false, risk:false};
    state.finalAnswers = {};
    state.flashIndex = 0;
    state.flashFlipped = false;

    $("notesBox").value = "";
    $("pillFinalScore").style.display = "none";
    $("finalReview").innerHTML = "";

    Object.keys(checks).forEach(renderCheck);
    renderFlash();
    renderFinalQuiz();
    setPills();
    window.scrollTo({top:0, behavior:"smooth"});
  }

  // Buttons
  $("btnJumpNotes").addEventListener("click", ()=>scrollToId("notes"));
  $("btnJumpFlash").addEventListener("click", ()=>scrollToId("flashcards"));
  $("btnJumpQuiz").addEventListener("click", ()=>scrollToId("finalQuiz"));
  $("btnReset").addEventListener("click", resetAll);

  $("btnFlip").addEventListener("click", flipFlash);
  $("btnNext").addEventListener("click", nextFlash);
  $("btnAgain").addEventListener("click", ()=>nextFlash());
  $("btnGood").addEventListener("click", ()=>nextFlash());

  $("btnExport").addEventListener("click", exportNotes);
  $("btnClearNotes").addEventListener("click", ()=>{$("notesBox").value="";});

  $("btnMarkFinal").addEventListener("click", markFinal);
  $("btnRetryFinal").addEventListener("click", retryFinal);

  // Init
  Object.keys(checks).forEach(renderCheck);
  renderFlash();
  renderFinalQuiz();
  setPills();
</script>
</body>
</html>
