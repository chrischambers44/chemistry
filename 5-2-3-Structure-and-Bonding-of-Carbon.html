<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AQA 5.2.3 Tutorial – Structure & Bonding of Carbon</title>
  <style>
    :root{
      --bg:#0b1020; --card:rgba(255,255,255,.08); --card2:rgba(255,255,255,.06);
      --text:#eef2ff; --muted:rgba(238,242,255,.75); --border:rgba(255,255,255,.14);
      --accent:#7c5cff; --good:#2ecc71; --bad:#ff5c7a; --warn:#ffd166;
    }
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:radial-gradient(1200px 650px at 10% 0%, rgba(124,92,255,.25), transparent 50%),
                 radial-gradient(900px 550px at 90% 10%, rgba(46,204,113,.18), transparent 55%),
                 linear-gradient(180deg, var(--bg), #050817);
      color:var(--text);
    }
    header{max-width:1100px; margin:0 auto; padding:28px 18px 10px;}
    h1{margin:0 0 8px; font-size:1.65rem;}
    .sub{color:var(--muted); line-height:1.35; max-width:980px;}
    .wrap{max-width:1100px; margin:0 auto; padding:12px 18px 48px; display:grid; gap:14px;}
    .toolbar{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      padding:12px; border:1px solid var(--border); border-radius:14px; background:var(--card);
    }
    .pill{padding:8px 10px; border-radius:999px; border:1px solid var(--border);
      background:rgba(0,0,0,.18); color:var(--muted); font-size:.92rem; white-space:nowrap;}
    button{
      border:1px solid var(--border); background:rgba(255,255,255,.08); color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:650;
    }
    button:hover{border-color:rgba(255,255,255,.28);}
    button.primary{
      background:linear-gradient(135deg, rgba(124,92,255,.95), rgba(124,92,255,.55));
      border-color:rgba(124,92,255,.65);
    }
    button.danger{
      background:linear-gradient(135deg, rgba(255,92,122,.95), rgba(255,92,122,.45));
      border-color:rgba(255,92,122,.6);
    }
    .card{padding:16px; border-radius:16px; border:1px solid var(--border); background:var(--card);}
    .grid{display:grid; grid-template-columns:repeat(auto-fit, minmax(270px, 1fr)); gap:12px;}
    h2{margin:0 0 10px; font-size:1.25rem;}
    h3{margin:0 0 8px; font-size:1.05rem;}
    .muted{color:var(--muted);}
    .callout{
      border-left:3px solid rgba(124,92,255,.7); padding:10px 12px; background:rgba(255,255,255,.05);
      border-radius:12px; margin-top:10px; color:var(--muted); line-height:1.45;
    }
    .kbox{
      border:1px solid var(--border); border-radius:14px; padding:12px; background:var(--card2);
    }
    ul{margin:8px 0 0 18px; color:var(--muted);}
    .diagram{
      border:1px dashed rgba(255,255,255,.24); border-radius:14px; padding:12px; background:rgba(0,0,0,.16);
      color:var(--muted); line-height:1.35;
    }
    .q{
      padding:12px; border:1px solid var(--border); border-radius:14px; background:rgba(255,255,255,.06);
      margin-top:10px;
    }
    .opts{display:grid; gap:8px; margin-top:10px;}
    label.opt{
      display:grid; grid-template-columns:22px 1fr; gap:10px; align-items:start;
      padding:10px 12px; border-radius:14px; border:1px solid var(--border);
      background:rgba(0,0,0,.14); cursor:pointer;
    }
    label.opt:hover{border-color:rgba(255,255,255,.28);}
    input[type="radio"]{margin-top:3px;}
    .resultLine{margin-top:10px; font-weight:700;}
    .good{color:#b7f7cd;}
    .bad{color:#ffc1cb;}
    details{border:1px solid var(--border); border-radius:14px; background:rgba(255,255,255,.05); padding:10px 12px;}
    summary{cursor:pointer; font-weight:750;}
    .flash{
      display:grid; gap:10px; align-items:center;
      border:1px solid var(--border); border-radius:16px; padding:14px;
      background:rgba(0,0,0,.16);
    }
    .flashFace{
      font-size:1.05rem; line-height:1.35;
    }
    .flashBtns{display:flex; gap:10px; flex-wrap:wrap;}
    .tiny{font-size:.92rem;}
    textarea{
      width:100%; min-height:90px; border-radius:12px; border:1px solid var(--border);
      padding:10px; background:rgba(0,0,0,.18); color:var(--text);
      resize:vertical;
    }
    .scoreBox{
      border:1px solid var(--border); border-radius:16px; padding:14px;
      background:rgba(255,255,255,.06);
    }
    .tag{
      display:inline-block; padding:4px 10px; border-radius:999px; border:1px solid var(--border);
      font-weight:800; font-size:.85rem; margin-left:8px;
    }
    .tag.good{background:rgba(46,204,113,.18); border-color:rgba(46,204,113,.35);}
    .tag.bad{background:rgba(255,92,122,.16); border-color:rgba(255,92,122,.35);}
  </style>
</head>
<body>
<header>
  <h1>AQA 5.2.3 Tutorial – Structure and bonding of carbon</h1>
  <div class="sub">
    This lesson covers the key carbon structures in AQA <b>5.2.3</b>: <b>diamond</b>, <b>graphite</b>, <b>graphene</b>, and <b>fullerenes (including nanotubes)</b>.
    Work through the notes, do the checks, then try the final quiz.
  </div>
</header>

<div class="wrap">
  <div class="toolbar">
    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
      <span class="pill" id="pillSection">Section: 5.2.3</span>
      <span class="pill" id="pillProgress">Progress: 0%</span>
      <span class="pill" id="pillChecks">Checks: 0/4 done</span>
    </div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
      <button id="btnJumpNotes">Jump to Notes</button>
      <button id="btnJumpFlash">Jump to Flashcards</button>
      <button class="primary" id="btnJumpQuiz">Jump to Final Quiz</button>
      <button class="danger" id="btnReset">Reset progress</button>
    </div>
  </div>

  <!-- NOTES -->
  <div class="card" id="notes">
    <h2>Core idea for 5.2.3</h2>
    <div class="callout">
      <b>Same element (carbon), different structure = different properties.</b><br>
      In these materials, each carbon atom forms strong covalent bonds, but the <b>arrangement</b> changes:
      how many bonds each carbon makes, whether there are <b>layers</b>, and whether there are <b>delocalised electrons</b>.
    </div>

    <div class="grid" style="margin-top:12px;">
      <div class="kbox">
        <h3>Diamond</h3>
        <ul>
          <li>Each carbon forms <b>4 covalent bonds</b> (tetrahedral arrangement).</li>
          <li><b>Giant covalent structure</b> (network/lattice).</li>
          <li><b>Very hard</b> because the structure is rigid and strongly bonded.</li>
          <li><b>Very high melting point</b> (many strong covalent bonds to break).</li>
          <li><b>Does not conduct electricity</b> (no free/delocalised electrons).</li>
        </ul>
        <div class="diagram tiny" style="margin-top:10px;">
          Visual idea: a 3D “net” where every carbon is bonded to 4 others.
        </div>

        <div class="q" data-check="diamond">
          <b>Quick check (Diamond)</b><br>
          Why doesn’t diamond conduct electricity?
          <div class="opts" id="opts_diamond"></div>
          <button class="primary" onclick="markCheck('diamond')">Mark</button>
          <div class="resultLine" id="res_diamond"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_diamond"></div>
          </details>
        </div>
      </div>

      <div class="kbox">
        <h3>Graphite</h3>
        <ul>
          <li>Each carbon forms <b>3 covalent bonds</b> → <b>layers</b> of hexagons.</li>
          <li>1 electron per carbon is <b>delocalised</b> and can move.</li>
          <li><b>Conducts electricity</b> (mobile delocalised electrons).</li>
          <li><b>Soft/slippery</b> because layers slide over each other (weak forces between layers).</li>
          <li><b>High melting point</b> (strong covalent bonds within layers).</li>
        </ul>
        <div class="diagram tiny" style="margin-top:10px;">
          Visual idea: stacks of “chicken wire” sheets. Strong bonds in sheets, weak forces between sheets.
        </div>

        <div class="q" data-check="graphite">
          <b>Quick check (Graphite)</b><br>
          Why is graphite soft and slippery?
          <div class="opts" id="opts_graphite"></div>
          <button class="primary" onclick="markCheck('graphite')">Mark</button>
          <div class="resultLine" id="res_graphite"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_graphite"></div>
          </details>
        </div>
      </div>

      <div class="kbox">
        <h3>Graphene</h3>
        <ul>
          <li>A single layer of graphite: <b>one atom thick</b> sheet of hexagons.</li>
          <li><b>Very strong</b> (strong covalent bonds across the sheet).</li>
          <li><b>Conducts electricity</b> (delocalised electrons).</li>
          <li><b>Large surface area</b> and very light → lots of potential uses.</li>
        </ul>
        <div class="callout tiny">
          AQA-style link: graphene is like “one layer of graphite”, so it shares conductivity, but is extremely thin and strong.
        </div>

        <div class="q" data-check="graphene">
          <b>Quick check (Graphene)</b><br>
          Which statement is best?
          <div class="opts" id="opts_graphene"></div>
          <button class="primary" onclick="markCheck('graphene')">Mark</button>
          <div class="resultLine" id="res_graphene"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_graphene"></div>
          </details>
        </div>
      </div>

      <div class="kbox">
        <h3>Fullerenes & nanotubes</h3>
        <ul>
          <li><b>Fullerenes</b> are molecules of carbon with a <b>hollow shape</b> (e.g. spheres, tubes).</li>
          <li><b>Nanotubes</b> are cylindrical fullerenes (like rolled-up graphene).</li>
          <li>Often have <b>useful electrical/strength properties</b>.</li>
          <li>Uses include: <b>catalysts</b>, <b>lubricants</b>, drug delivery (idea), and reinforcing materials.</li>
        </ul>
        <div class="diagram tiny" style="margin-top:10px;">
          Visual idea: a football-shaped cage (C60) or tiny tubes (nanotubes).
        </div>

        <div class="q" data-check="fullerenes">
          <b>Quick check (Fullerenes)</b><br>
          Which description matches a carbon nanotube?
          <div class="opts" id="opts_fullerenes"></div>
          <button class="primary" onclick="markCheck('fullerenes')">Mark</button>
          <div class="resultLine" id="res_fullerenes"></div>
          <details style="margin-top:8px;">
            <summary>Explanation</summary>
            <div class="muted tiny" id="exp_fullerenes"></div>
          </details>
        </div>
      </div>
    </div>
  </div>

  <!-- FLASHCARDS -->
  <div class="card" id="flashcards">
    <h2>Flashcards (retrieval practice)</h2>
    <div class="muted">
      Use these to practise quick recall. Click <b>Flip</b> then rate yourself. Aim for “Good” twice in a row.
    </div>
    <div class="flash" style="margin-top:12px;">
      <div class="flashFace" id="flashFace"></div>
      <div class="muted tiny" id="flashHint"></div>
      <div class="flashBtns">
        <button id="btnFlip" class="primary">Flip</button>
        <button id="btnAgain">Again</button>
        <button id="btnGood">Good</button>
        <button id="btnNext">Next</button>
      </div>
    </div>
    <div class="callout tiny">
      Tip: If a card is “Again”, say the answer out loud, then read it, then repeat once more.
    </div>
  </div>

  <!-- NOTES / EXPORT -->
  <div class="card">
    <h2>My notes (optional)</h2>
    <div class="muted">Write a few bullet points of what you find hardest. You can export them to copy/paste.</div>
    <textarea id="notesBox" placeholder="Example: I forget why graphite conducts, and why layers slide..."></textarea>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
      <button id="btnExport" class="primary">Export notes (copy)</button>
      <button id="btnClearNotes">Clear notes</button>
      <span class="pill" id="pillCopied" style="display:none;">Copied!</span>
    </div>
  </div>

  <!-- FINAL QUIZ -->
  <div class="card" id="finalQuiz">
    <h2>Final quiz (mixed)</h2>
    <div class="muted">Try this without looking back. Then check the review to see what to revise.</div>
    <div id="quizArea" style="margin-top:12px;"></div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center;">
      <button class="primary" id="btnMarkFinal">Mark final quiz</button>
      <button id="btnRetryFinal">Retry final quiz</button>
      <span class="pill" id="pillFinalScore" style="display:none;"></span>
    </div>
    <div id="finalReview" style="margin-top:12px;"></div>
  </div>
</div>

<script>
  // -------------------------
  // Data for quick checks (4)
  // -------------------------
  const checks = {
    diamond: {
      q: "Why doesn’t diamond conduct electricity?",
      options: [
        "Because it contains no electrons at all",
        "Because all its electrons are used in bonds so there are no mobile charge carriers",
        "Because it is a metal",
        "Because it has weak intermolecular forces"
      ],
      answer: 1,
      explanation: "Diamond is a giant covalent structure where each carbon forms 4 bonds. There are no delocalised electrons, so there are no mobile charge carriers to carry current."
    },
    graphite: {
      q: "Why is graphite soft and slippery?",
      options: [
        "Because it has weak bonds within each layer",
        "Because it has layers with weak forces between them, so layers can slide",
        "Because it has no structure",
        "Because it is made of small molecules"
      ],
      answer: 1,
      explanation: "Graphite has strong covalent bonds within each layer, but only weak forces between layers. Those layers can slide over each other, making graphite soft."
    },
    graphene: {
      q: "Which statement is best?",
      options: [
        "Graphene is a single layer of carbon atoms arranged in a hexagonal lattice",
        "Graphene is an ionic compound",
        "Graphene is made of separate small molecules",
        "Graphene cannot conduct electricity"
      ],
      answer: 0,
      explanation: "Graphene is a single-atom-thick sheet of carbon atoms in hexagons. Like graphite, it has delocalised electrons and can conduct electricity."
    },
    fullerenes: {
      q: "Which description matches a carbon nanotube?",
      options: [
        "A 3D tetrahedral network where each carbon bonds to four others",
        "A stack of layers held together by weak forces",
        "A cylindrical fullerene, like a rolled-up graphene sheet",
        "A mixture of hydrocarbons"
      ],
      answer: 2,
      explanation: "Nanotubes are cylindrical fullerenes. You can picture them as graphene sheets rolled into tiny tubes; they can be strong and sometimes conduct electricity."
    }
  };

  // -------------------------
  // Flashcards (retrieval)
  // -------------------------
  const flashcards = [
    {front:"Diamond: how many bonds does each carbon make?", back:"4 covalent bonds (tetrahedral), forming a giant covalent network.", hint:"Link to hardness and high melting point."},
    {front:"Diamond: why is it very hard?", back:"Because every carbon is strongly bonded in a rigid 3D network; there are no layers that can slide.", hint:"Structure → property."},
    {front:"Diamond: why doesn’t it conduct electricity?", back:"No delocalised electrons; all outer electrons are in covalent bonds.", hint:"No mobile charge carriers."},
    {front:"Graphite: how many bonds does each carbon make?", back:"3 covalent bonds, forming hexagonal layers.", hint:"Leaves 1 electron delocalised."},
    {front:"Graphite: why does it conduct electricity?", back:"One electron per carbon is delocalised and can move along the layers, carrying charge.", hint:"Delocalised electrons."},
    {front:"Graphite: why is it soft?", back:"Layers are held together by weak forces, so they slide over each other.", hint:"Weak interlayer forces."},
    {front:"Graphene: what is it?", back:"A single layer of carbon atoms in a hexagonal lattice (one layer of graphite).", hint:"One atom thick."},
    {front:"Graphene: give two key properties.", back:"Very strong + conducts electricity (also huge surface area and very light).", hint:"Structure explains both."},
    {front:"Fullerene: what does the term mean?", back:"A carbon molecule with a hollow shape (e.g. spheres or tubes).", hint:"Not a giant lattice like diamond."},
    {front:"Nanotubes: what are they and why useful?", back:"Cylindrical fullerenes; can be strong, light, and conduct—useful for reinforcing materials and electronics.", hint:"Rolled graphene idea."}
  ];

  // -------------------------
  // Final quiz (10 Qs)
  // -------------------------
  const finalQuiz = [
    {
      id:"F1",
      q:"Which carbon structure is a giant covalent network where each carbon forms 4 bonds?",
      options:["Graphite","Diamond","Graphene","C60 fullerene"],
      a:1,
      exp:"Diamond has 4 bonds per carbon in a 3D network, giving hardness and very high melting point."
    },
    {
      id:"F2",
      q:"Graphite conducts electricity mainly because…",
      options:["It is ionic","It has delocalised electrons that can move","It contains metal ions","It is a liquid"],
      a:1,
      exp:"Each carbon forms 3 bonds, leaving 1 delocalised electron per carbon that can move along layers."
    },
    {
      id:"F3",
      q:"Graphite is soft because…",
      options:["Covalent bonds within layers are weak","Layers slide due to weak forces between them","It has no bonds at all","It is made of small molecules"],
      a:1,
      exp:"Strong covalent bonds within layers, weak forces between layers → layers slide."
    },
    {
      id:"F4",
      q:"Graphene is best described as…",
      options:["A single layer of carbon atoms arranged in hexagons","A 3D tetrahedral network","A mixture of hydrocarbons","An ionic lattice"],
      a:0,
      exp:"Graphene is one atom thick and arranged in a hexagonal lattice."
    },
    {
      id:"F5",
      q:"Which pair of properties best fits graphene?",
      options:["Low melting point + non-conductor","Very strong + conducts electricity","Soft + non-conductor","Brittle + low boiling point"],
      a:1,
      exp:"Strong covalent bonds make it strong; delocalised electrons allow conduction."
    },
    {
      id:"F6",
      q:"A fullerene is…",
      options:["A carbon lattice with layers","A carbon molecule with a hollow shape","A type of metal alloy","A salt"],
      a:1,
      exp:"Fullerenes are hollow carbon molecules (e.g., spheres or tubes)."
    },
    {
      id:"F7",
      q:"A carbon nanotube can be thought of as…",
      options:["Graphite layers stacked","A rolled-up graphene sheet","Diamond crystals crushed small","A hydrocarbon chain"],
      a:1,
      exp:"Nanotubes are cylindrical fullerenes; a good model is ‘rolled graphene’."
    },
    {
      id:"F8",
      q:"Why do diamond and graphite both have high melting points?",
      options:["They are made of small molecules","They have many strong covalent bonds to break","They are liquids","They are ionic compounds"],
      a:1,
      exp:"Both have giant covalent bonding (diamond 3D; graphite within layers), so lots of energy is needed to break bonds."
    },
    {
      id:"F9",
      q:"Which statement is correct?",
      options:[
        "Diamond conducts electricity well",
        "Graphite and graphene can conduct electricity",
        "Graphene is made of ions",
        "Fullerenes are always giant lattices"
      ],
      a:1,
      exp:"Graphite and graphene have delocalised electrons. Diamond does not; fullerenes are molecular, not giant lattices."
    },
    {
      id:"F10",
      q:"Choose the best ‘structure → property’ link:",
      options:[
        "Diamond is soft because layers slide",
        "Graphite conducts because it has mobile delocalised electrons",
        "Graphene is weak because it is thin",
        "Fullerenes are ionic so conduct when solid"
      ],
      a:1,
      exp:"Delocalised electrons in graphite allow charge to move, so it conducts."
    }
  ];

  // -------------------------
  // State
  // -------------------------
  const state = {
    checksDone: {diamond:false, graphite:false, graphene:false, fullerenes:false},
    checkScores: {diamond:null, graphite:null, graphene:null, fullerenes:null},
    flashIndex: 0,
    flashFlipped: false,
    finalAnswers: {}, // id -> optionIndex
  };

  // -------------------------
  // Helpers
  // -------------------------
  function $(id){ return document.getElementById(id); }

  function scrollToId(id){
    document.getElementById(id).scrollIntoView({behavior:"smooth", block:"start"});
  }

  function setPills(){
    const doneCount = Object.values(state.checksDone).filter(Boolean).length;
    const progress = Math.round(((doneCount) / 4) * 60 + (Object.keys(state.finalAnswers).length / finalQuiz.length) * 40);
    $("pillProgress").textContent = `Progress: ${progress}%`;
    $("pillChecks").textContent = `Checks: ${doneCount}/4 done`;
  }

  function renderCheck(key){
    const c = checks[key];
    const wrap = $("opts_"+key);
    wrap.innerHTML = "";
    c.options.forEach((opt, i) => {
      const lab = document.createElement("label");
      lab.className = "opt";
      const inp = document.createElement("input");
      inp.type = "radio";
      inp.name = "chk_"+key;
      inp.value = i;
      const div = document.createElement("div");
      div.textContent = opt;
      lab.appendChild(inp);
      lab.appendChild(div);
      wrap.appendChild(lab);
    });
    $("exp_"+key).textContent = c.explanation;
  }

  function markCheck(key){
    const c = checks[key];
    const chosen = document.querySelector(`input[name="chk_${key}"]:checked`);
    const res = $("res_"+key);
    if(!chosen){
      res.innerHTML = `<span style="color:var(--warn)"><b>Please choose an answer first.</b></span>`;
      return;
    }
    const val = Number(chosen.value);
    const ok = val === c.answer;
    state.checksDone[key] = true;
    state.checkScores[key] = ok;

    res.innerHTML = ok
      ? `<span class="good">✔ Correct</span> <span class="muted tiny">— ${c.options[c.answer]}</span>`
      : `<span class="bad">✘ Incorrect</span> <span class="muted tiny">— Correct: ${c.options[c.answer]}</span>`;

    setPills();
  }

  // Flashcards
  function renderFlash(){
    const card = flashcards[state.flashIndex];
    state.flashFlipped = false;
    $("flashFace").textContent = card.front;
    $("flashHint").textContent = "Hint: " + card.hint;
    $("btnFlip").textContent = "Flip";
  }
  function flipFlash(){
    const card = flashcards[state.flashIndex];
    state.flashFlipped = !state.flashFlipped;
    $("flashFace").textContent = state.flashFlipped ? card.back : card.front;
    $("btnFlip").textContent = state.flashFlipped ? "Show question" : "Flip";
  }
  function nextFlash(){
    state.flashIndex = (state.flashIndex + 1) % flashcards.length;
    renderFlash();
  }

  // Notes export
  async function exportNotes(){
    const txt = $("notesBox").value.trim();
    if(!txt){
      alert("No notes yet. Write a couple of lines first.");
      return;
    }
    await navigator.clipboard.writeText(txt);
    $("pillCopied").style.display = "inline-block";
    setTimeout(()=> $("pillCopied").style.display = "none", 1200);
  }

  // Final quiz
  function renderFinalQuiz(){
    const qa = $("quizArea");
    qa.innerHTML = "";
    finalQuiz.forEach((q, idx) => {
      const card = document.createElement("div");
      card.className = "q";
      card.innerHTML = `<b>Q${idx+1}.</b> ${q.q}`;
      const opts = document.createElement("div");
      opts.className = "opts";

      q.options.forEach((opt, i) => {
        const lab = document.createElement("label");
        lab.className = "opt";
        const inp = document.createElement("input");
        inp.type = "radio";
        inp.name = "final_"+q.id;
        inp.value = i;
        if(state.finalAnswers[q.id] === i) inp.checked = true;
        inp.addEventListener("change", () => {
          state.finalAnswers[q.id] = i;
          setPills();
        });
        const div = document.createElement("div");
        div.textContent = opt;
        lab.appendChild(inp);
        lab.appendChild(div);
        opts.appendChild(lab);
      });

      card.appendChild(opts);
      qa.appendChild(card);
    });
    setPills();
  }

  function markFinal(){
    let correct = 0;
    const total = finalQuiz.length;
    const review = [];

    finalQuiz.forEach((q) => {
      const chosen = (q.id in state.finalAnswers) ? state.finalAnswers[q.id] : null;
      const ok = chosen === q.a;
      if(ok) correct++;
      review.push({q, chosen, ok});
    });

    const pct = Math.round((correct/total)*100);
    $("pillFinalScore").style.display = "inline-block";
    $("pillFinalScore").textContent = `Final quiz score: ${correct}/${total} (${pct}%)`;

    // Build review
    const fr = $("finalReview");
    fr.innerHTML = review.map((r, i) => {
      const tag = r.ok ? `<span class="tag good">Correct</span>` : `<span class="tag bad">Incorrect</span>`;
      const your = (r.chosen===null) ? "<i>(blank)</i>" : r.q.options[r.chosen];
      const cor = r.q.options[r.q.a];

      return `
        <div class="scoreBox" style="margin-top:10px;">
          <div><b>Q${i+1}.</b> ${r.q.q} ${tag}</div>
          <div class="muted" style="margin-top:6px;"><b>Your answer:</b> ${your}</div>
          <div class="muted"><b>Correct answer:</b> ${cor}</div>
          <div class="callout tiny"><b>Why:</b> ${r.q.exp}</div>
        </div>
      `;
    }).join("");

    scrollToId("finalReview");
  }

  function retryFinal(){
    state.finalAnswers = {};
    $("pillFinalScore").style.display = "none";
    $("finalReview").innerHTML = "";
    renderFinalQuiz();
    scrollToId("finalQuiz");
  }

  function resetAll(){
    state.checksDone = {diamond:false, graphite:false, graphene:false, fullerenes:false};
    state.checkScores = {diamond:null, graphite:null, graphene:null, fullerenes:null};
    state.flashIndex = 0;
    state.flashFlipped = false;
    state.finalAnswers = {};
    $("notesBox").value = "";
    $("pillFinalScore").style.display = "none";
    $("finalReview").innerHTML = "";
    // Re-render checks and quiz
    Object.keys(checks).forEach(renderCheck);
    renderFlash();
    renderFinalQuiz();
    setPills();
    window.scrollTo({top:0, behavior:"smooth"});
  }

  // -------------------------
  // Wire up buttons
  // -------------------------
  $("btnJumpNotes").addEventListener("click", ()=>scrollToId("notes"));
  $("btnJumpFlash").addEventListener("click", ()=>scrollToId("flashcards"));
  $("btnJumpQuiz").addEventListener("click", ()=>scrollToId("finalQuiz"));
  $("btnReset").addEventListener("click", resetAll);

  $("btnFlip").addEventListener("click", flipFlash);
  $("btnNext").addEventListener("click", nextFlash);
  $("btnAgain").addEventListener("click", ()=>{ /* simple: just go next */ nextFlash(); });
  $("btnGood").addEventListener("click", ()=>{ /* simple: just go next */ nextFlash(); });

  $("btnExport").addEventListener("click", exportNotes);
  $("btnClearNotes").addEventListener("click", ()=>{$("notesBox").value="";});

  $("btnMarkFinal").addEventListener("click", markFinal);
  $("btnRetryFinal").addEventListener("click", retryFinal);

  // -------------------------
  // Init
  // -------------------------
  Object.keys(checks).forEach(renderCheck);
  renderFlash();
  renderFinalQuiz();
  setPills();
</script>
</body>
</html>
